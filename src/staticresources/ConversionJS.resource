"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):window.imageConversion=e()}(function(){var e={urltoImage:function(e){return new Promise(function(t,a){var n=new Image;n.onload=function(){return t(n)},n.onerror=function(){return a(new Error("urltoImage(): Image failed to load, please check the image URL"))},n.src=e})},urltoBlob:function(e){return fetch(e).then(function(e){return e.blob()})},imagetoCanvas:async function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=document.createElement("canvas"),n=a.getContext("2d"),r=void 0,i=void 0;if(t.scale){var o=t.scale>0&&t.scale<10?t.scale:1;i=e.width*o,r=e.height*o}else i=t.width||e.width,r=t.height||e.height;switch([5,6,7,8].some(function(e){return e===Number(t.orientation)})?(a.height=i,a.width=r):(a.height=r,a.width=i),Number(t.orientation)){case 3:n.rotate(180*Math.PI/180),n.drawImage(e,-a.width,-a.height,a.width,a.height);break;case 6:n.rotate(90*Math.PI/180),n.drawImage(e,0,-a.width,a.height,a.width);break;case 8:n.rotate(270*Math.PI/180),n.drawImage(e,-a.height,0,a.height,a.width);break;case 2:n.translate(a.width,0),n.scale(-1,1),n.drawImage(e,0,0,a.width,a.height);break;case 4:n.translate(a.width,0),n.scale(-1,1),n.rotate(180*Math.PI/180),n.drawImage(e,-a.width,-a.height,a.width,a.height);break;case 5:n.translate(a.width,0),n.scale(-1,1),n.rotate(90*Math.PI/180),n.drawImage(e,0,-a.width,a.height,a.width);break;case 7:n.translate(a.width,0),n.scale(-1,1),n.rotate(270*Math.PI/180),n.drawImage(e,-a.height,0,a.height,a.width);break;default:n.drawImage(e,0,0,a.width,a.height)}return a},canvastoFile:function(e,t){return new Promise(function(a){return e.toBlob(function(e){return a(e)},"image/jpeg",t)})},canvastoDataURL:async function(e,t){return e.toDataURL("image/jpeg",t)},filetoDataURL:function(e){return new Promise(function(t){var a=new FileReader;a.onloadend=function(e){return t(e.target.result)},a.readAsDataURL(e)})},dataURLtoImage:function(e){return new Promise(function(t,a){var n=new Image;n.onload=function(){return t(n)},n.onerror=function(){return a(new Error("dataURLtoImage(): dataURL is illegal"))},n.src=e})},dataURLtoFile:async function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],r=atob(a[1]),i=r.length,o=new Uint8Array(i);i--;)o[i]=r.charCodeAt(i);return["image/png","image/jpeg","image/gif"].every(function(e){return e!==t})&&(t=n),new Blob([o],{type:t})},downloadFile:function(e,t){var a=document.createElement("a");a.href=window.URL.createObjectURL(e),a.download=t||Date.now().toString(36),document.body.appendChild(a);var n=document.createEvent("MouseEvents");n.initEvent("click",!1,!1),a.dispatchEvent(n),document.body.removeChild(a)},compress:async function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if("object"!==(void 0===a?"undefined":_typeof(a))&&(a=Object.assign({quality:a})),a.quality=Number(a.quality),Number.isNaN(a.quality))return t;var n=await e.filetoDataURL(t),r=n.split(",")[0].match(/:(.*?);/)[1],i=await e.dataURLtoImage(n),o=await e.imagetoCanvas(i,a),c=await e.canvastoDataURL(o,a.quality);return["image/png","image/jpeg","image/gif"].every(function(e){return e!==a.type})&&(a.type=r),await e.dataURLtoFile(c,r)},compressAccurately:async function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if("object"!==(void 0===a?"undefined":_typeof(a))&&(a=Object.assign({size:a})),a.size=Number(a.size),Number.isNaN(a.size))return t;if(1024*a.size>t.size)return t;a.accuracy=Number(a.accuracy),(!a.accuracy||a.accuracy<.8||a.accuracy>.99)&&(a.accuracy=.95);for(var n=a.size*(2-a.accuracy)*1024,r=1024*a.size,i=a.size*a.accuracy*1024,o=await e.filetoDataURL(t),c=o.split(",")[0].match(/:(.*?);/)[1],u=await e.dataURLtoImage(o),s=await e.imagetoCanvas(u,a),d=.5,h=void 0,l=[null,null],f=1;f<=7;f++){var g=.75*(h=await e.canvastoDataURL(s,d)).length;if(7===f){(n<g||i>g)&&(h=[h].concat(l).filter(function(e){return e}).sort(function(e,t){return Math.abs(.75*e.length-r)-Math.abs(.75*t.length-r)})[0]);break}if(n<g)l[1]=h,d-=.5**(f+1);else{if(!(i>g))break;l[0]=h,d+=.5**(f+1)}}return["image/png","image/jpeg","image/gif"].every(function(e){return e!==a.type})&&(a.type=c),await e.dataURLtoFile(h,a.type)}};return e});